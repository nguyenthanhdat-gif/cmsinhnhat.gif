<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ÃŠ Biáº¿t Nay NgÃ y GÃ¬ KhÃ´ng ??</title>

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
<link rel="stylesheet" href="./style/style.css">
</head>
<body>

<button id="mode-toggle" title="Chuyá»ƒn Ä‘á»•i cháº¿ Ä‘á»™ sÃ¡ng/tá»‘i">ğŸŒ™</button>
<button id="music-btn" title="PhÃ¡t/táº¡m dá»«ng nháº¡c ná»n">ğŸ”‡</button>

<div class="container">
  <h1>ÃŠ Biáº¿t Nay NgÃ y GÃ¬ KhÃ´ng ???</h1>
  <img src="https://i.pinimg.com/736x/79/81/88/79818873e3d488ba818c8aaad7ff470c.jpg" alt="Avatar" class="avatar" />

  <h1>Cho mi 3s Ä‘á»ƒ má»Ÿ ra coi Ä‘Ã³ ğŸ˜¤</h1>

  <div>
    <button class="btn" id="open-gift-btn" aria-haspopup="dialog" aria-controls="popup" aria-expanded="false">Coi láº¹ Ä‘iğŸ˜</button>
    <button class="btn" id="exit-btn" aria-haspopup="dialog">KhÃ´ng thÃ¬ cÃºt ğŸ˜’</button>
  </div>
</div>

<div class="popup" id="exit-popup" role="alertdialog" aria-modal="true">
  <center><img src="https://i.pinimg.com/736x/32/a5/4d/32a54dc49f2dbd53374f67b025a3d6c4.jpg" alt="Xin lá»—i mÃ "/></center>
  <h2>ÃŠ giá»¡n Ã¡ ğŸ˜¢</h2>
  <p>Báº¥m má»Ÿ coi Ä‘i mÃ , nÄƒn ná»‰ Ã¡ ğŸ¥º</p>
  <button class="close-btn" id="close-exit-btn">Ok nÃ¨ğŸ˜</button>
</div>

<!-- Popup QuÃ  -->
<div class="popup" id="popup" role="dialog" aria-modal="true" aria-labelledby="popup-title" aria-describedby="popup-desc">
  <center><img src="https://i.pinimg.com/736x/0d/5b/f3/0d5bf3ef087a77846742fa96fa300f07.jpg" alt="QuÃ  sinh nháº­t" /></center>
  <h2 id="popup-title">Báº¥t ngá» chÆ°a!</h2>
  <div id="typing-text" aria-live="polite" aria-atomic="true"></div>
  <button class="close-btn" id="close-popup-btn">ÄÃ³ng</button>
</div>

<!-- Canvas phÃ¡o hoa -->
<canvas id="fireworks"></canvas>

<!-- Nháº¡c ná»n -->
<audio id="bg-music" autoplay loop>
  <source src="style/Happy Birthday to You (Always 14) - AMEE x HoÃ ng DÅ©ng x Obito x Há»©a Kim Tuyá»n  OFFICIAL LYRIC VIDEO.mp3" type="audio/mpeg" />
</audio>

<!-- Popup Ä‘oÃ¡n tuá»•i -->
<div class="popup" id="guess-age-popup">
  <center><img src="https://i.pinimg.com/736x/aa/3a/dd/aa3add4a9fcb132c14ac9c6ede3baf7e.jpg" alt="Guess age" style="width: 120px;"/></center>
  <h2>Khai tuá»•i tháº­t Ä‘i ğŸ¤¨</h2>
  <div style="display: flex; justify-content: center; gap: 10px; margin-top: 20px;">
    <button class="btn age-btn" data-age="20">U20</button>
    <button class="btn age-btn" data-age="18">U25</button>
    <button class="btn age-btn" data-age="20">U30</button>
  </div>
</div>
</body>
</html>

<script>
// === ÄoÃ¡n tuá»•i ngÆ°á»i nháº­n === //
const agePopup = document.getElementById("guess-age-popup");
const ageButtons = document.querySelectorAll(".age-btn");
const correctAge = "18";

// Hiá»‡n popup sau 4 giÃ¢y khi vÃ o trang
setTimeout(() => {
  agePopup.classList.add("show");
}, 500);

ageButtons.forEach(btn => {
  btn.addEventListener("click", () => {
    const selected = btn.dataset.age;
    if (selected === correctAge) {
      agePopup.innerHTML = `
        <center><img src="https://i.pinimg.com/736x/47/c2/49/47c2493fecd4a231eddc88b69991cc27.jpg" alt="Congrats" style="width: 140px;"/></center>
        <h2>Giá»i! Trung thá»±c ğŸ˜</h2>
        <p>Há»i chÆ¡i cho zui thÃ´i bÃ  ğŸ˜</p>
        <button class="close-btn" onclick="agePopup.classList.remove('show')">Zui záº» khÃ´ng quáº¡o</button>
      `;
    } else {
      agePopup.innerHTML = `
        <center><img src="https://i.pinimg.com/736x/81/f1/74/81f17472464b344c13286ef3ef2ab794.jpg" alt="Wrong" style="width: 120px;"/></center>
        <h2>á»¦a lÃ  sao dá»‹ bÃ ? ğŸ˜¤</h2>
        <p>Cho mi chá»n láº¡i 1 láº§n ná»¯a Ä‘Ã³!!!</p>
        <button class="close-btn" onclick="location.reload()">ÄoÃ¡n láº¡i cho bá»‘ ğŸ«¤</button>
      `;
    }
  });
});
  // Dark mode toggle
  const modeToggleBtn = document.getElementById("mode-toggle");
  function updateModeIcon() {
    modeToggleBtn.textContent = document.body.classList.contains("dark") ? "â˜€ï¸" : "ğŸŒ™";
  }
  modeToggleBtn.addEventListener("click", () => {
    document.body.classList.toggle("dark");
    updateModeIcon();
  });
  updateModeIcon();

const musicBtn = document.getElementById("music-btn");
  const music = document.getElementById("bg-music");
  let isPlaying = false;

  // Cá»‘ gáº¯ng phÃ¡t nháº¡c khi trang táº£i
  window.addEventListener("load", () => {
    music.volume = 0.2;
    const tryPlay = () => {
      music.play().then(() => {
        musicBtn.textContent = "ğŸ”Š";
        isPlaying = true;
      }).catch(() => {
        musicBtn.textContent = "ğŸ”‡";
        isPlaying = false;
      });
    };

    tryPlay();

    // Náº¿u autoplay bá»‹ cháº·n, phÃ¡t khi ngÆ°á»i dÃ¹ng láº§n Ä‘áº§u click
    document.body.addEventListener("click", function once() {
      if (!isPlaying) tryPlay();
      document.body.removeEventListener("click", once);
    });
  });

  // Xá»­ lÃ½ khi báº¥m nÃºt Ã¢m thanh
  musicBtn.addEventListener("click", () => {
    if (isPlaying) {
      music.pause();
      musicBtn.textContent = "ğŸ”‡";
    } else {
      music.play();
      musicBtn.textContent = "ğŸ”Š";
    }
    isPlaying = !isPlaying;
  });

  // Typing effect for multiple lines
  const messages = [
    "Sinh nháº­t dui dáº» nha bÃ , quÃ½ láº¯m má»›i chÃºc Ã¡ nha bÃ ! ğŸ’ğŸ‚.",
    "Mong sao tuá»•i má»›i bÃ  sáº½ mang Ä‘áº¿n tháº­t nhiá»u háº¡nh phÃºc vÃ  sá»©c khá»e dá»“i dÃ o! ğŸ‰âœ¨.",
    "ChÃºc sao cho bÃ  luÃ´n thÃ nh cÃ´ng ná»¯a nÃ¨, lÃ m gÃ¬ cÅ©ng thuáº­n lá»£i ğŸ¥°ğŸ€.",
    "ThÃªm má»™t tuá»•i má»›i, chÃºc sao cho bÃ  luÃ´n dui dáº» bÃªn báº¡n bÃ¨, gia Ä‘Ã¬nh vÃ  ngÆ°á»i bÃ  luÃ´n yÃªu thÆ°Æ¡ng ğŸ¤—ğŸ’.",
    "HÃ£y táº­n hÆ°á»Ÿng ngÃ y Ä‘áº·c biá»‡t nÃ y vá»›i tháº­t nhiá»u niá»m vui vÃ  tiáº¿ng cÆ°á»i nhÃ©! â¤ï¸ğŸˆ"
  ];
  const typingTextElem = document.getElementById("typing-text");
  let msgIndex = 0;
  let charIndex = 0;
  let typingTimeout;

  function typeMessage() {
    if (msgIndex >= messages.length) {
      return; // done all messages
    }
    const currentMsg = messages[msgIndex];
    if (charIndex < currentMsg.length) {
      typingTextElem.textContent += currentMsg.charAt(charIndex);
      charIndex++;
      typingTimeout = setTimeout(typeMessage, 50);
    } else {
      // pause before next message
      typingTimeout = setTimeout(() => {
        typingTextElem.textContent += "\n\n";
        msgIndex++;
        charIndex = 0;
        typeMessage();
      }, 1000);
    }
  }

  // Reset and start typing when popup opens
  function startTyping() {
    clearTimeout(typingTimeout);
    typingTextElem.textContent = "";
    msgIndex = 0;
    charIndex = 0;
    typeMessage();
  }

  // Falling emojis animation (flower, cake, heart)
  function createFallingEmoji() {
    const emojiList = ["ğŸŒ¸", "ğŸ‰", "ğŸ°", "ğŸ’–","ğŸ¥°", "ğŸ‚", "ğŸ€"];
    const emoji = document.createElement("div");
    emoji.className = "falling-emoji";
    emoji.textContent = emojiList[Math.floor(Math.random() * emojiList.length)];
    emoji.style.left = Math.random() * 100 + "vw";
    emoji.style.fontSize = (Math.random() * 20 + 24) + "px";
    emoji.style.animationDuration = (Math.random() * 5 + 4) + "s";
    emoji.style.opacity = Math.random() * 0.6 + 0.4;
    document.body.appendChild(emoji);

    emoji.addEventListener("animationend", () => {
      emoji.remove();
    });
  }
  setInterval(createFallingEmoji, 350);

  // Popup open/close & fireworks
  const popup = document.getElementById("popup");
  const openGiftBtn = document.getElementById("open-gift-btn");
  const closePopupBtn = document.getElementById("close-popup-btn");

  openGiftBtn.addEventListener("click", openPopupAndFireworks);
  closePopupBtn.addEventListener("click", () => {
    popup.classList.remove("show");
    stopFireworks();
  });

  function openPopupAndFireworks() {
    popup.classList.add("show");
    openGiftBtn.setAttribute("aria-expanded", "true");
    startTyping();  // <-- Báº¯t Ä‘áº§u gÃµ chá»¯ khi má»Ÿ popup
    startFireworks();
  }

  // Fireworks effect (multiple points, smooth)
  const canvas = document.getElementById("fireworks");
  const ctx = canvas.getContext("2d");
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;

  let fireworks = [];
  let particles = [];
  let animationFrameId;

  class Firework {
    constructor(sx, sy, tx, ty) {
      this.x = sx;
      this.y = sy;
      this.sx = sx;
      this.sy = sy;
      this.tx = tx;
      this.ty = ty;
      this.distanceToTarget = distance(sx, sy, tx, ty);
      this.distanceTraveled = 0;
      this.coordinates = [];
      this.coordinateCount = 3;
      while(this.coordinateCount--) {
        this.coordinates.push([this.x, this.y]);
      }
      this.angle = Math.atan2(ty - sy, tx - sx);
      this.speed = 5;
      this.acceleration = 1.05;
      this.brightness = random(50, 70);
      this.targetRadius = 8;
    }
    update(index) {
      this.coordinates.pop();
      this.coordinates.unshift([this.x, this.y]);

      if(this.targetRadius < 8) this.targetRadius += 0.3;
      this.speed *= this.acceleration;

      let vx = Math.cos(this.angle) * this.speed;
      let vy = Math.sin(this.angle) * this.speed;
      this.distanceTraveled = distance(this.sx, this.sy, this.x + vx, this.y + vy);

      if(this.distanceTraveled >= this.distanceToTarget) {
        createParticles(this.tx, this.ty);
        fireworks.splice(index, 1);
      } else {
        this.x += vx;
        this.y += vy;
      }
    }
    draw() {
      ctx.beginPath();
      ctx.moveTo(this.coordinates[this.coordinates.length - 1][0], this.coordinates[this.coordinates.length - 1][1]);
      ctx.lineTo(this.x, this.y);
      ctx.strokeStyle = `hsl(${random(0, 360)}, 100%, ${this.brightness}%)`;
      ctx.stroke();

      ctx.beginPath();
      ctx.arc(this.tx, this.ty, this.targetRadius, 0, Math.PI * 2);
      ctx.stroke();
    }
  }

  class Particle {
    constructor(x, y) {
      this.x = x;
      this.y = y;
      this.coordinates = [];
      this.coordinateCount = 5;
      while(this.coordinateCount--) {
        this.coordinates.push([this.x, this.y]);
      }
      this.angle = random(0, Math.PI * 2);
      this.speed = random(1, 10);
      this.friction = 0.95;
      this.gravity = 0.7;
      this.hue = random(0, 360);
      this.brightness = random(50, 80);
      this.alpha = 1;
      this.decay = random(0.015, 0.03);
    }
    update(index) {
      this.coordinates.pop();
      this.coordinates.unshift([this.x, this.y]);
      this.speed *= this.friction;
      this.x += Math.cos(this.angle) * this.speed;
      this.y += Math.sin(this.angle) * this.speed + this.gravity;
      this.alpha -= this.decay;

      if(this.alpha <= 0) {
        particles.splice(index, 1);
      }
    }
    draw() {
      ctx.beginPath();
      ctx.moveTo(this.coordinates[this.coordinates.length - 1][0], this.coordinates[this.coordinates.length - 1][1]);
      ctx.lineTo(this.x, this.y);
      ctx.strokeStyle = `hsla(${this.hue}, 100%, ${this.brightness}%, ${this.alpha})`;
      ctx.stroke();
    }
  }

  function createParticles(x, y) {
    let particleCount = 30;
    while(particleCount--) {
      particles.push(new Particle(x, y));
    }
  }

  function distance(aX, aY, bX, bY) {
    let x = bX - aX;
    let y = bY - aY;
    return Math.sqrt(x * x + y * y);
  }

  function random(min, max) {
    return Math.random() * (max - min) + min;
  }

  function loop() {
    animationFrameId = requestAnimationFrame(loop);
    ctx.globalCompositeOperation = 'destination-out';
    ctx.fillStyle = 'rgba(0, 0, 0, 0.2)';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.globalCompositeOperation = 'lighter';

    let i = fireworks.length;
    while(i--) {
      fireworks[i].draw();
      fireworks[i].update(i);
    }

    i = particles.length;
    while(i--) {
      particles[i].draw();
      particles[i].update(i);
    }

    if(fireworks.length < 5) {
      fireworks.push(new Firework(
        canvas.width / 2,
        canvas.height,
        random(100, canvas.width - 100),
        random(50, canvas.height / 2)
      ));
    }
  }

  function startFireworks() {
    if(!animationFrameId) {
      loop();
    }
  }
  function stopFireworks() {
    cancelAnimationFrame(animationFrameId);
    animationFrameId = null;
    fireworks = [];
    particles = [];
    ctx.clearRect(0, 0, canvas.width, canvas.height);
  }

  // Resize canvas on window resize
  window.addEventListener('resize', () => {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  });

  // NÃºt "ThoÃ¡t"
const exitBtn = document.getElementById("exit-btn");
const exitPopup = document.getElementById("exit-popup");
const closeExitBtn = document.getElementById("close-exit-btn");

exitBtn.addEventListener("click", () => {
  exitPopup.classList.add("show");
});

closeExitBtn.addEventListener("click", () => {
  exitPopup.classList.remove("show");
});

let moveCount = 0;
const maxMoves = 2;

exitBtn.addEventListener("mouseover", () => {
  if (moveCount < maxMoves) {
    const x = Math.floor(Math.random() * (window.innerWidth - 150));
    const y = Math.floor(Math.random() * (window.innerHeight - 100));
    exitBtn.style.position = "absolute";
    exitBtn.style.left = `${x}px`;
    exitBtn.style.top = `${y}px`;
    moveCount++;
  }
});

closePopupBtn.addEventListener("click", () => {
  popup.classList.remove("show");
  stopFireworks();
  moveCount = 0; 
});
</script>
